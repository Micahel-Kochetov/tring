name: Sonar

on:
  push:
    branches: [ sonar ]
  pull_request:
    branches: [ sonar ]
      
jobs:
  build:
  
      runs-on: mcr.microsoft.com/dotnet/framework/sdk:4.8-windowsservercore-ltsc2019
      
      steps:
      - name: sonar-scanner-install
        run: |
          Invoke-RestMethod -Uri https://download.visualstudio.microsoft.com/download/pr/928b2d78-4b74-4601-9c82-334cdbb1b3b4/ce4ff79bed538d9fde90f4ac1020ea59e02538ef7e10af3b97b687b89e8662a3/vs_BuildTools.exe
          .\vs_buildtools.exe --quiet --add Microsoft.VisualStudio.Workload.VCTools
          ls C:\Program Files (x86)\Microsoft Visual Studio\2022\BuildTools\MSBuild\Current\Bin
          Invoke-RestMethod -Uri https://github.com/SonarSource/sonar-scanner-msbuild/releases/download/5.5.3.43281/sonar-scanner-msbuild-5.5.3.43281-net46.zip -OutFile sonar-scanner-msbuild-5.5.3.43281-net46.zip
          Expand-Archive .\sonar-scanner-msbuild-5.5.3.43281-net46.zip -DestinationPath d:\sonar-scaner
                    
      - name: repo
        uses: actions/checkout@v1
        
      - name: sonar-scanner-run
        run: |
          d:\sonar-scaner\SonarScanner.MSBuild.exe begin /k:"tring" /d:sonar.host.url="https://sonarqube.devsoftengi.space" /d:sonar.login="09c76e3588c0c06e1f84355d1c44d8c82a0e7f7a"
          MsBuild.exe /t:Rebuild
          
