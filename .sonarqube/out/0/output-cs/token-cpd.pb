ß°
TC:\Users\–ö–ª–∏–º–Ω—é–∫\tring\App\Assets\Editor\Migration\AddVuforiaEnginePackage.cs
[

 
InitializeOnLoad

 
]

 
public 
class #
AddVuforiaEnginePackage $
{ 
static 

readonly 
string 
sPackagesPath (
=) *
Path+ /
./ 0
Combine0 7
(7 8
Application8 C
.C D
dataPathD L
,L M
$strN R
,R S
$strT ^
)^ _
;_ `
static 

readonly 
string 
sManifestJsonPath ,
=- .
Path/ 3
.3 4
Combine4 ;
(; <
sPackagesPath< I
,I J
$strK Z
)Z [
;[ \
const 	
string
 
VUFORIA_VERSION  
=! "
$str# *
;* +
const 	
string
 
PACKAGE_KEY 
= 
$str 7
;7 8
const 	
string
 
GIT_URL 
= 
$str K
;K L
static 

readonly 
ScopedRegistry "
sVuforiaRegistry# 3
=4 5
new6 9
ScopedRegistry: H
(H I
)I J
{ 
name 
= 
$str 
, 
url 
= 
$str @
,@ A
scopes 
= 
new 
[ 
] 
{ 
$str )
}) *
} 
; 
static 

ListRequest 
sListRequest #
;# $
static 
#
AddVuforiaEnginePackage "
(" #
)# $
{ 
if 

( 
Application 
. 
isBatchMode #
)# $
return 
; 
var!! 
manifest!! 
=!! 
Manifest!! 
.!!  
JsonDeserialize!!  /
(!!/ 0
sManifestJsonPath!!0 A
)!!A B
;!!B C
if## 

(## 
!## 
IsUsingGitUrl## 
(## 
manifest## #
)### $
)##$ %%
DisplayAddPackageDialogue$$ %
($$% &
manifest$$& .
)$$. /
;$$/ 0
}%% 
static'' 

bool'' 
IsUsingGitUrl'' 
('' 
Manifest'' &
manifest''' /
)''/ 0
{(( 
var)) 
dependencies)) 
=)) 
manifest)) #
.))# $
Dependencies))$ 0
.))0 1
Split))1 6
())6 7
$char))7 :
))): ;
.)); <
ToList))< B
())B C
)))C D
;))D E
return** 
dependencies** 
.** 
Any** 
(**  
d**  !
=>**" $
d**% &
.**& '
Contains**' /
(**/ 0
PACKAGE_KEY**0 ;
)**; <
&&**= ?
d**@ A
.**A B
Contains**B J
(**J K
GIT_URL**K R
)**R S
)**S T
;**T U
}++ 
static.. 

void.. %
DisplayAddPackageDialogue.. )
(..) *
Manifest..* 2
manifest..3 ;
)..; <
{// 
if00 

(00 
EditorUtility00 
.00 
DisplayDialog00 '
(00' (
$str00( D
,00D E
$"11 P
DWould you like to update your project to include the Vuforia Engine 11 R
{11R S
VUFORIA_VERSION11S b
}11b c 
 package from Git?\n11c w
"11w x
+11y z
$"22 q
eIf an older Vuforia Engine package is already present in your project it will be upgraded to version 22 s
{22s t
VUFORIA_VERSION	22t É
}
22É Ñ
"
22Ñ Ö
,
22Ö Ü
$str
22á è
,
22è ê
$str
22ë ô
)
22ô ö
)
22ö õ
{33 	
UpdateManifest44 
(44 
manifest44 #
)44# $
;44$ %
}55 	
}66 
static99 

void99 
UpdateManifest99 
(99 
Manifest99 '
manifest99( 0
)990 1
{:: 
var<< 

registries<< 
=<< 
manifest<< !
.<<! "
ScopedRegistries<<" 2
.<<2 3
ToList<<3 9
(<<9 :
)<<: ;
;<<; <
if== 

(== 

registries== 
.== 
Contains== 
(==  
sVuforiaRegistry==  0
)==0 1
)==1 2
{>> 	

registries?? 
.?? 
Remove?? 
(?? 
sVuforiaRegistry?? .
)??. /
;??/ 0
manifest@@ 
.@@ 
ScopedRegistries@@ %
=@@& '

registries@@( 2
.@@2 3
ToArray@@3 :
(@@: ;
)@@; <
;@@< =
}AA 	
SetVuforiaVersionDD 
(DD 
manifestDD "
)DD" #
;DD# $
manifestFF 
.FF 
JsonSerializeFF 
(FF 
sManifestJsonPathFF 0
)FF0 1
;FF1 2
AssetDatabaseHH 
.HH 
RefreshHH 
(HH 
)HH 
;HH  
}II 
staticKK 

voidKK 
SetVuforiaVersionKK !
(KK! "
ManifestKK" *
manifestKK+ 3
)KK3 4
{LL 
varMM 
dependenciesMM 
=MM 
manifestMM #
.MM# $
DependenciesMM$ 0
.MM0 1
SplitMM1 6
(MM6 7
$charMM7 :
)MM: ;
.MM; <
ToListMM< B
(MMB C
)MMC D
;MMD E
varOO 
versionEntryOO 
=OO 
$"OO 
\"OO 
{OO  
GIT_URLOO  '
}OO' (
#OO( )
{OO) *
VUFORIA_VERSIONOO* 9
}OO9 :
\"OO: <
"OO< =
;OO= >
varQQ 

versionSetQQ 
=QQ 
falseQQ 
;QQ 
forRR 
(RR 
varRR 
iRR 
=RR 
$numRR 
;RR 
iRR 
<RR 
dependenciesRR (
.RR( )
CountRR) .
;RR. /
iRR0 1
++RR1 3
)RR3 4
{SS 	
ifTT 
(TT 
!TT 
dependenciesTT 
[TT 
iTT 
]TT  
.TT  !
ContainsTT! )
(TT) *
PACKAGE_KEYTT* 5
)TT5 6
)TT6 7
continueUU 
;UU 
varWW 
kvpWW 
=WW 
dependenciesWW "
[WW" #
iWW# $
]WW$ %
.WW% &
SplitWW& +
(WW+ ,
$charWW, /
)WW/ 0
;WW0 1
kvpYY 
[YY 
$numYY 
]YY 
=YY 
versionEntryYY !
;YY! "
dependencies[[ 
[[[ 
i[[ 
][[ 
=[[ 
string[[ $
.[[$ %
Join[[% )
([[) *
$str[[* -
,[[- .
kvp[[/ 2
)[[2 3
;[[3 4

versionSet]] 
=]] 
true]] 
;]] 
}^^ 	
if`` 

(`` 
!`` 

versionSet`` 
)`` 
dependenciesaa 
.aa 
Insertaa 
(aa  
$numaa  !
,aa! "
$"aa# %
\n    \"aa% -
{aa- .
PACKAGE_KEYaa. 9
}aa9 :
\": aa: >
{aa> ?
versionEntryaa? K
}aaK L
"aaL M
)aaM N
;aaN O
manifestcc 
.cc 
Dependenciescc 
=cc 
stringcc  &
.cc& '
Joincc' +
(cc+ ,
$strcc, /
,cc/ 0
dependenciescc1 =
)cc= >
;cc> ?
}dd 
classff 	
Manifestff
 
{gg 
consthh 
inthh 
INDEX_NOT_FOUNDhh !
=hh" #
-hh$ %
$numhh% &
;hh& '
constii 
stringii 
DEPENDENCIES_KEYii %
=ii& '
$strii( :
;ii: ;
publickk 
ScopedRegistrykk 
[kk 
]kk 
ScopedRegistrieskk  0
;kk0 1
publicll 
stringll 
Dependenciesll "
;ll" #
publicnn 
voidnn 
JsonSerializenn !
(nn! "
stringnn" (
pathnn) -
)nn- .
{oo 	
varpp 

jsonStringpp 
=pp 
GetJsonStringpp *
(pp* +
)pp+ ,
;pp, -
varrr 

startIndexrr 
=rr  
GetDependenciesStartrr 1
(rr1 2

jsonStringrr2 <
)rr< =
;rr= >
varss 
endIndexss 
=ss 
GetDependenciesEndss -
(ss- .

jsonStringss. 8
,ss8 9

startIndexss: D
)ssD E
;ssE F
varuu 
stringBuilderuu 
=uu 
newuu  #
StringBuilderuu$ 1
(uu1 2
)uu2 3
;uu3 4
stringBuilderww 
.ww 
Appendww  
(ww  !

jsonStringww! +
.ww+ ,
	Substringww, 5
(ww5 6
$numww6 7
,ww7 8

startIndexww9 C
)wwC D
)wwD E
;wwE F
stringBuilderxx 
.xx 
Appendxx  
(xx  !
Dependenciesxx! -
)xx- .
;xx. /
stringBuilderyy 
.yy 
Appendyy  
(yy  !

jsonStringyy! +
.yy+ ,
	Substringyy, 5
(yy5 6
endIndexyy6 >
,yy> ?

jsonStringyy@ J
.yyJ K
LengthyyK Q
-yyR S
endIndexyyT \
)yy\ ]
)yy] ^
;yy^ _
File{{ 
.{{ 
WriteAllText{{ 
({{ 
path{{ "
,{{" #
stringBuilder{{$ 1
.{{1 2
ToString{{2 :
({{: ;
){{; <
){{< =
;{{= >
}|| 	
string~~ 
GetJsonString~~ 
(~~ 
)~~ 
{ 	
if
ÄÄ 
(
ÄÄ 
ScopedRegistries
ÄÄ  
.
ÄÄ  !
Length
ÄÄ! '
>
ÄÄ( )
$num
ÄÄ* +
)
ÄÄ+ ,
return
ÅÅ 
JsonUtility
ÅÅ "
.
ÅÅ" #
ToJson
ÅÅ# )
(
ÅÅ) *
new
ÇÇ '
UnitySerializableManifest
ÇÇ 1
{
ÇÇ2 3
scopedRegistries
ÇÇ3 C
=
ÇÇD E
ScopedRegistries
ÇÇF V
,
ÇÇV W
dependencies
ÇÇX d
=
ÇÇe f
new
ÇÇg j$
DependencyPlaceholderÇÇk Ä
(ÇÇÄ Å
)ÇÇÅ Ç
}ÇÇÇ É
,ÇÇÉ Ñ
true
ÉÉ 
)
ÉÉ 
;
ÉÉ 
return
ÖÖ 
JsonUtility
ÖÖ 
.
ÖÖ 
ToJson
ÖÖ %
(
ÖÖ% &
new
ÜÜ 7
)UnitySerializableManifestDependenciesOnly
ÜÜ =
(
ÜÜ= >
)
ÜÜ> ?
{
ÜÜ@ A
dependencies
ÜÜA M
=
ÜÜN O
new
ÜÜP S#
DependencyPlaceholder
ÜÜT i
(
ÜÜi j
)
ÜÜj k
}
ÜÜk l
,
ÜÜl m
true
áá 
)
áá 
;
áá 
}
àà 	
public
ãã 

static
ãã 
Manifest
ãã 
JsonDeserialize
ãã *
(
ãã* +
string
ãã+ 1
path
ãã2 6
)
ãã6 7
{
åå 
var
çç 

jsonString
çç 
=
çç 
File
çç 
.
çç 
ReadAllText
çç )
(
çç) *
path
çç* .
)
çç. /
;
çç/ 0
var
èè 

registries
èè 
=
èè 
JsonUtility
èè $
.
èè$ %
FromJson
èè% -
<
èè- .'
UnitySerializableManifest
èè. G
>
èèG H
(
èèH I

jsonString
èèI S
)
èèS T
.
èèT U
scopedRegistries
èèU e
??
èèf h
new
èèi l
ScopedRegistry
èèm {
[
èè{ |
$num
èè| }
]
èè} ~
;
èè~ 
var
êê 
dependencies
êê 
=
êê %
DeserializeDependencies
êê 2
(
êê2 3

jsonString
êê3 =
)
êê= >
;
êê> ?
return
íí 
new
íí 
Manifest
íí 
{
íí 
ScopedRegistries
íí -
=
íí. /

registries
íí0 :
,
íí: ;
Dependencies
íí< H
=
ííI J
dependencies
ííK W
}
ííW X
;
ííX Y
}
ìì 
static
ïï 

string
ïï %
DeserializeDependencies
ïï )
(
ïï) *
string
ïï* 0
json
ïï1 5
)
ïï5 6
{
ññ 
var
óó 

startIndex
óó 
=
óó "
GetDependenciesStart
óó -
(
óó- .
json
óó. 2
)
óó2 3
;
óó3 4
var
òò 
endIndex
òò 
=
òò  
GetDependenciesEnd
òò )
(
òò) *
json
òò* .
,
òò. /

startIndex
òò0 :
)
òò: ;
;
òò; <
if
öö 

(
öö 

startIndex
öö 
==
öö 
INDEX_NOT_FOUND
öö )
||
öö* ,
endIndex
öö- 5
==
öö6 8
INDEX_NOT_FOUND
öö9 H
)
ööH I
return
õõ 
null
õõ 
;
õõ 
var
ùù 
dependencies
ùù 
=
ùù 
json
ùù 
.
ùù  
	Substring
ùù  )
(
ùù) *

startIndex
ùù* 4
,
ùù4 5
endIndex
ùù6 >
-
ùù? @

startIndex
ùùA K
)
ùùK L
;
ùùL M
return
ûû 
dependencies
ûû 
;
ûû 
}
üü 
static
°° 

int
°° "
GetDependenciesStart
°° #
(
°°# $
string
°°$ *
json
°°+ /
)
°°/ 0
{
¢¢ 
var
££ 
dependenciesIndex
££ 
=
££ 
json
££  $
.
££$ %
IndexOf
££% ,
(
££, -
DEPENDENCIES_KEY
££- =
,
££= >
StringComparison
££? O
.
££O P
InvariantCulture
££P `
)
££` a
;
££a b
if
§§ 

(
§§ 
dependenciesIndex
§§ 
==
§§  
INDEX_NOT_FOUND
§§! 0
)
§§0 1
return
•• 
INDEX_NOT_FOUND
•• "
;
••" #
var
ßß $
dependenciesStartIndex
ßß "
=
ßß# $
json
ßß% )
.
ßß) *
IndexOf
ßß* 1
(
ßß1 2
$char
ßß2 5
,
ßß5 6
dependenciesIndex
ßß7 H
+
ßßI J
DEPENDENCIES_KEY
ßßK [
.
ßß[ \
Length
ßß\ b
)
ßßb c
;
ßßc d
if
©© 

(
©© $
dependenciesStartIndex
©© "
==
©©# %
INDEX_NOT_FOUND
©©& 5
)
©©5 6
return
™™ 
INDEX_NOT_FOUND
™™ "
;
™™" #$
dependenciesStartIndex
¨¨ 
++
¨¨  
;
¨¨  !
return
ÆÆ $
dependenciesStartIndex
ÆÆ %
;
ÆÆ% &
}
ØØ 
static
±± 

int
±±  
GetDependenciesEnd
±± !
(
±±! "
string
±±" (

jsonString
±±) 3
,
±±3 4
int
±±5 8$
dependenciesStartIndex
±±9 O
)
±±O P
{
≤≤ 
return
≥≥ 

jsonString
≥≥ 
.
≥≥ 
IndexOf
≥≥ !
(
≥≥! "
$char
≥≥" %
,
≥≥% &$
dependenciesStartIndex
≥≥' =
)
≥≥= >
;
≥≥> ?
}
¥¥ 
}µµ 
class∑∑ 7
)UnitySerializableManifestDependenciesOnly
∑∑ /
{∏∏ 
public
ππ 
#
DependencyPlaceholder
ππ  
dependencies
ππ! -
;
ππ- .
}∫∫ 
classºº '
UnitySerializableManifest
ºº 
{ΩΩ 
public
ææ 

ScopedRegistry
ææ 
[
ææ 
]
ææ 
scopedRegistries
ææ ,
;
ææ, -
public
øø 
#
DependencyPlaceholder
øø  
dependencies
øø! -
;
øø- .
}¿¿ 
[¬¬ 
Serializable
¬¬ 
]
¬¬ 
struct√√ 
ScopedRegistry
√√ 
{ƒƒ 
public
≈≈ 

string
≈≈ 
name
≈≈ 
;
≈≈ 
public
∆∆ 

string
∆∆ 
url
∆∆ 
;
∆∆ 
public
«« 

string
«« 
[
«« 
]
«« 
scopes
«« 
;
«« 
public
…… 

override
…… 
bool
…… 
Equals
…… 
(
……  
object
……  &
obj
……' *
)
……* +
{
   
if
ÀÀ 

(
ÀÀ 
!
ÀÀ 
(
ÀÀ 
obj
ÀÀ 
is
ÀÀ 
ScopedRegistry
ÀÀ #
)
ÀÀ# $
)
ÀÀ$ %
return
ÃÃ 
false
ÃÃ 
;
ÃÃ 
var
ŒŒ 
other
ŒŒ 
=
ŒŒ 
(
ŒŒ 
ScopedRegistry
ŒŒ #
)
ŒŒ# $
obj
ŒŒ% (
;
ŒŒ( )
return
–– 
name
–– 
==
–– 
other
–– 
.
–– 
name
–– !
&&
––" $
url
—— 
==
—— 
other
—— 
.
—— 
url
—— 
&&
——  "
scopes
““ 
.
““ 
SequenceEqual
““ #
(
““# $
other
““$ )
.
““) *
scopes
““* 0
)
““0 1
;
““1 2
}
”” 
public
’’ 

static
’’ 
bool
’’ 
operator
’’ 
==
’’  "
(
’’" #
ScopedRegistry
’’# 1
a
’’2 3
,
’’3 4
ScopedRegistry
’’5 C
b
’’D E
)
’’E F
{
÷÷ 
return
◊◊ 
a
◊◊ 
.
◊◊ 
Equals
◊◊ 
(
◊◊ 
b
◊◊ 
)
◊◊ 
;
◊◊ 
}
ÿÿ 
public
⁄⁄ 

static
⁄⁄ 
bool
⁄⁄ 
operator
⁄⁄ 
!=
⁄⁄  "
(
⁄⁄" #
ScopedRegistry
⁄⁄# 1
a
⁄⁄2 3
,
⁄⁄3 4
ScopedRegistry
⁄⁄5 C
b
⁄⁄D E
)
⁄⁄E F
{
€€ 
return
‹‹ 
!
‹‹ 
a
‹‹ 
.
‹‹ 
Equals
‹‹ 
(
‹‹ 
b
‹‹ 
)
‹‹ 
;
‹‹ 
}
›› 
public
ﬂﬂ 

override
ﬂﬂ 
int
ﬂﬂ 
GetHashCode
ﬂﬂ #
(
ﬂﬂ# $
)
ﬂﬂ$ %
{
‡‡ 
var
·· 
hash
·· 
=
·· 
$num
·· 
;
·· 
foreach
„„ 
(
„„ 
var
„„ 
scope
„„ 
in
„„ 
scopes
„„ $
)
„„$ %
hash
‰‰ 
=
‰‰ 
hash
‰‰ 
*
‰‰ 
$num
‰‰ 
+
‰‰ 
(
‰‰  
scope
‰‰  %
==
‰‰& (
null
‰‰) -
?
‰‰. /
$num
‰‰0 1
:
‰‰2 3
scope
‰‰4 9
.
‰‰9 :
GetHashCode
‰‰: E
(
‰‰E F
)
‰‰F G
)
‰‰G H
;
‰‰H I
hash
ÊÊ 
=
ÊÊ 
hash
ÊÊ 
*
ÊÊ 
$num
ÊÊ 
+
ÊÊ 
(
ÊÊ 
name
ÊÊ  
==
ÊÊ! #
null
ÊÊ$ (
?
ÊÊ) *
$num
ÊÊ+ ,
:
ÊÊ- .
name
ÊÊ/ 3
.
ÊÊ3 4
GetHashCode
ÊÊ4 ?
(
ÊÊ? @
)
ÊÊ@ A
)
ÊÊA B
;
ÊÊB C
hash
ÁÁ 
=
ÁÁ 
hash
ÁÁ 
*
ÁÁ 
$num
ÁÁ 
+
ÁÁ 
(
ÁÁ 
url
ÁÁ 
==
ÁÁ  "
null
ÁÁ# '
?
ÁÁ( )
$num
ÁÁ* +
:
ÁÁ, -
url
ÁÁ. 1
.
ÁÁ1 2
GetHashCode
ÁÁ2 =
(
ÁÁ= >
)
ÁÁ> ?
)
ÁÁ? @
;
ÁÁ@ A
return
ÈÈ 
hash
ÈÈ 
;
ÈÈ 
}
ÍÍ 
}ÎÎ 
[ÌÌ 
Serializable
ÌÌ 
]
ÌÌ 
struct
ÓÓ 
#
DependencyPlaceholder
ÓÓ  
{
ÓÓ! "
}
ÓÓ# $
}ÔÔ 